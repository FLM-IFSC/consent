<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Termo de Consentimento - IFSC (LGPD/ECA)</title>
    <!-- Carrega Tailwind CSS para estilização e responsividade -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuração do Tailwind CSS (Fonte Inter) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .form-input {
            width: 100%;
            padding: 8px 12px;
            margin-top: 4px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .pdf-content-container {
            max-width: 210mm; /* Largura A4 */
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        .print-only { display: none; }
        .no-print { display: block; }

        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .pdf-content-container {
                margin: 0;
                border: none;
                box-shadow: none;
                padding: 0;
            }
        }
        /* Estilos específicos para o conteúdo do PDF */
        .pdf-content-container h1, .pdf-content-container h2 {
            page-break-after: avoid;
        }
    </style>
    <!-- Biblioteca html2pdf para geração de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

    <div class="p-4 md:p-8">
        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-10 border border-gray-200">
            <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Gerador de Termo de Consentimento (IFSC)</h1>
            <p class="text-gray-600 mb-6">Preencha os dados abaixo e clique em "Gerar PDF do Termo" para finalizar o documento.</p>

            <!-- Área de Preenchimento (Não será exibida no PDF) -->
            <div id="form-fields" class="no-print mb-8 p-4 bg-blue-50 rounded-lg">
                <h2 class="text-xl font-semibold mb-4 text-blue-800">1. Dados para Preenchimento</h2>
                
                <!-- Dados do Responsável -->
                <h3 class="text-lg font-semibold mt-4 mb-2">Responsável Legal</h3>
                <label for="responsavel_nome" class="block text-sm font-medium text-gray-700">Nome do Responsável Legal:</label>
                <input type="text" id="responsavel_nome" class="form-input focus:ring-blue-500 focus:border-blue-500" required>
                
                <label for="responsavel_cpf" class="block text-sm font-medium text-gray-700">CPF do Responsável Legal:</label>
                <input type="text" id="responsavel_cpf" class="form-input focus:ring-blue-500 focus:border-blue-500" placeholder="000.000.000-00" required>

                <!-- Dados do Menor -->
                <h3 class="text-lg font-semibold mt-4 mb-2">Menor de Idade</h3>
                <label for="menor_nome" class="block text-sm font-medium text-gray-700">Nome Completo do Menor:</label>
                <input type="text" id="menor_nome" class="form-input focus:ring-blue-500 focus:border-blue-500" required>

                <label for="menor_cpf" class="block text-sm font-medium text-gray-700">CPF do Menor:</label>
                <input type="text" id="menor_cpf" class="form-input focus:ring-blue-500 focus:border-blue-500" placeholder="000.000.000-00" required>
                
                <!-- Campus e Local/Data -->
                <h3 class="text-lg font-semibold mt-4 mb-2">Informações do Termo</h3>
                <label for="campus_selecionado" class="block text-sm font-medium text-gray-700">Campus de Referência:</label>
                <select id="campus_selecionado" class="form-input focus:ring-blue-500 focus:border-blue-500" required>
                    <option value="" disabled selected>Selecione o Campus</option>
                    <option value="Araranguá">Araranguá</option>
                    <option value="Caçador">Caçador</option>
                    <option value="Canoinhas">Canoinhas</option>
                    <option value="Chapecó">Chapecó</option>
                    <option value="Criciúma">Criciúma</option>
                    <option value="Concórdia">Concórdia</option>
                    <option value="Florianópolis - Centro">Florianópolis - Centro</option>
                    <option value="Florianópolis - Continente">Florianópolis - Continente</option>
                    <option value="Gaspar">Gaspar</option>
                    <option value="Itajaí">Itajaí</option>
                    <option value="Jaraguá do Sul - Centro">Jaraguá do Sul - Centro</option>
                    <option value="Jaraguá do Sul - Rau">Jaraguá do Sul - Rau</option>
                    <option value="Joinville">Joinville</option>
                    <option value="Lages">Lages</option>
                    <option value="Palhoça">Palhoça</option>
                    <option value="São Carlos">São Carlos</option>
                    <option value="São Francisco do Sul">São Francisco do Sul</option>
                    <option value="São José">São José</option>
                    <option value="São Lourenço do Oeste">São Lourenço do Oeste</option>
                    <option value="Tijucas">Tijucas</option>
                    <option value="Tubarão">Tubarão</option>
                    <option value="Urupema">Urupema</option>
                    <option value="Xanxerê">Xanxerê</option>
                </select>

                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="w-full sm:w-1/2">
                        <label for="local_cidade" class="block text-sm font-medium text-gray-700">Local (cidade):</label>
                        <input type="text" id="local_cidade" class="form-input focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label for="data_atual" class="block text-sm font-medium text-gray-700">Data:</label>
                        <input type="date" id="data_atual" class="form-input focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>

                <button onclick="generatePDF()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-150 shadow-md hover:shadow-lg mt-4">
                    Gerar PDF do Termo
                </button>
                <p id="error-message" class="text-red-500 mt-2 hidden">Por favor, preencha todos os campos obrigatórios e selecione um Campus.</p>
            </div>
            
            <!-- Orientações de Assinatura Gov.br (INSTRUÇÕES VISÍVEIS NA TELA, MAS FORA DO PDF) -->
            <div id="signing-instructions" class="no-print mb-8 p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-500 shadow-md">
                <h2 class="font-bold text-xl mb-3 text-yellow-800">Orientações para Assinatura Eletrônica via Gov.br</h2>
                <p class="text-sm text-justify mb-4">
                    Este Termo poderá ser assinado eletronicamente por meio da plataforma **Gov.br**. A assinatura eletrônica possui a mesma validade jurídica de uma assinatura física, conforme o **Decreto nº 10.543/2020**.
                </p>
                <ol class="list-decimal list-inside space-y-2 text-sm md:text-base ml-4 text-gray-700">
                    <li class="text-justify">Acesse o portal do Assinador ITI: <a href="https://assinador.iti.br/" target="_blank" class="text-blue-600 hover:underline font-medium">assinador.iti.br</a> (O serviço ADES/UFSC, <a href="https://ades.labsec.ufsc.br/assina" target="_blank" class="text-blue-600 hover:underline font-medium">ades.labsec.ufsc.br/assina</a>, também pode ser utilizado como alternativa).</li>
                    <li class="text-justify">Certifique-se de ter uma conta Gov.br nível **Prata** ou **Ouro**. Se necessário, utilize a biometria facial do TSE no aplicativo Gov.br para elevar o nível da sua conta.</li>
                    <li class="text-justify">Envie o Termo preenchido (em formato PDF) para a plataforma de assinatura e selecione o ponto em que a assinatura deve ser colocada.</li>
                    <li class="text-justify">Siga as instruções na tela para revisar o documento e confirmar sua assinatura.</li>
                </ol>
            </div>
            <!-- Fim das Orientações (Fora do PDF) -->


            <!-- Área de Conteúdo do Termo (Para visualização e PDF) -->
            <div id="pdf-content" class="pdf-content-container">
                <h1 class="text-xl font-bold text-gray-900 mb-6 text-center">ANEXO I - TERMO DE CONSENTIMENTO PARA COLETA E TRATAMENTO DE DADOS BIOMÉTRICOS DE MENORES</h1>
                
                <p class="mb-4 text-justify">
                    Eu, <span id="display_responsavel_nome" class="font-semibold underline"></span>, responsável legal pelo(a) menor <span id="display_menor_nome_intro" class="font-semibold underline"></span>, portador(a) do CPF <span id="display_menor_cpf_intro" class="font-semibold underline"></span>, por meio deste documento, manifesto meu **consentimento livre, informado e inequívoco** para a coleta e o tratamento da biometria facial do(a) referido(a) menor pelo Instituto Federal de Santa Catarina (IFSC), exclusivamente para fins de controle de acesso físico às dependências do Campus e eventual acesso a salas específicas do Campus.
                </p>

                <!-- Campo dinâmico do Campus selecionado -->
                <p class="mb-4 font-semibold text-sm text-gray-800 text-center border-t border-b py-2">
                    Campus de Referência: <span id="display_campus_selecionado" class="text-blue-700"></span>
                </p>
                
                <h2 class="font-bold mt-6 mb-3 text-lg">Declaro estar ciente de que:</h2>
                <ol class="list-decimal list-inside space-y-3 text-sm md:text-base">
                    <li class="text-justify">A biometria facial será utilizada somente para **autenticação e autorização de entrada física** no Campus do IFSC e, se aplicável, em salas específicas, visando garantir a segurança dos(as) alunos(as), servidores(as) e do patrimônio da instituição.</li>
                    
                    <li class="text-justify">
                        **Guarda e Eliminação (Conformidade LGPD e Arquivo Nacional):** As imagens faciais capturadas e os **dados biométricos derivados (templates matemáticos)** serão utilizados exclusivamente para a finalidade de autenticação, sendo **permanentemente eliminados dos sistemas assim que o vínculo do(a) aluno(a) com o IFSC for encerrado** (Princípio da Necessidade da LGPD). Já os **registros de acesso e frequência (logs)** seguirão os prazos de guarda e destinação estabelecidos nas Tabelas de Temporalidade e Destinação de Documentos relativas às atividades-meio e fim, aprovadas pelo Arquivo Nacional.
                    </li>

                    <li class="text-justify">Os dados serão mantidos de forma segura e protegida, com acesso restrito a pessoas autorizadas e mediante aplicação de medidas técnicas e organizacionais compatíveis com a Lei Geral de Proteção de Dados Pessoais (LGPD) pelo tempo necessário.</li>
                    
                    <li class="text-justify">A qualquer momento, poderei **revogar este consentimento**, mediante solicitação formal enviada ao canal oficial de atendimento do IFSC ou ao Encarregado de Proteção de Dados (DPO) da instituição, ciente de que isso poderá impactar o acesso do(a) menor às dependências ou a determinadas salas do Campus.</li>
                    
                    <li class="text-justify">Os dados biométricos do(a) menor **não serão compartilhados com terceiros**, exceto quando necessário para cumprimento de obrigações legais ou regulatórias.</li>
                    
                    <li class="text-justify">Terei acesso, sempre que solicitado, às informações sobre o tratamento dos dados do(a) menor, incluindo a possibilidade de retificação, exclusão ou limitação do uso, conforme previsto na LGPD.</li>
                </ol>

                <p class="mt-6 mb-6 text-justify">
                    **Concedo meu consentimento de forma livre, informada, expressa e inequívoca, nos termos da Lei Geral de Proteção de Dados Pessoais (LGPD), da Lei nº 8.069/1990 (ECA) e demais legislação pertinente, visando o melhor interesse do(a) menor.**
                </p>

                <p class="text-sm mt-8">
                    <span id="display_local_cidade" class="font-semibold underline"></span>, <span id="display_data_atual" class="font-semibold underline"></span>.
                </p>

                <h2 class="font-bold mt-10 mb-2 text-lg">Dados para Referência:</h2>

                <p class="mb-1 text-sm">
                    **Dados do Menor:**
                </p>
                <p class="text-sm ml-4">
                    Nome completo legível: <span id="display_menor_nome_ref" class="font-semibold underline"></span>.
                </p>
                <p class="mb-4 text-sm ml-4">
                    CPF: <span id="display_menor_cpf_ref" class="font-semibold underline"></span>
                </p>

                <p class="mb-1 text-sm">
                    **Dados do Responsável Legal:**
                </p>
                <p class="text-sm ml-4">
                    Nome completo legível: <span id="display_responsavel_nome_ref" class="font-semibold underline"></span>.
                </p>
                <p class="mb-4 text-sm ml-4">
                    CPF: <span id="display_responsavel_cpf_ref" class="font-semibold underline"></span>
                </p>
                
                <p class="mt-8 text-center text-sm font-bold border-t pt-4">
                    Assinatura Digital Gov.br:
                </p>
                <p class="text-center text-sm font-normal">
                    (O documento assinado eletronicamente via Gov.br dispensa assinatura manual e comprova o consentimento.)
                </p>
                <!-- Links no PDF -->
                <p class="text-center text-xs mt-2 text-gray-600">
                    Plataformas de Assinatura: <a href="https://assinador.iti.br/" target="_blank" class="text-blue-600 hover:underline">assinador.iti.br</a> | <a href="https://ades.labsec.ufsc.br/assina" target="_blank" class="text-blue-600 hover:underline">ades.labsec.ufsc.br/assina</a>
                </p>
                <!-- Fim Links no PDF -->
            </div>
            
            <!-- Link para re-gerar (visível após o preenchimento) -->
            <div id="re-generate" class="no-print mt-6 text-center hidden">
                <button onclick="location.reload()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md hover:shadow-lg">
                    Preencher Novo Termo
                </button>
            </div>
        </div>
    </div>

    <script>
        // Função para formatar a data (DD/MM/AAAA)
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Função principal para preencher os campos e gerar o PDF
        function generatePDF() {
            // 1. Coleta de Dados
            const respNome = document.getElementById('responsavel_nome').value.trim();
            const menorNome = document.getElementById('menor_nome').value.trim();
            const menorCpf = document.getElementById('menor_cpf').value.trim();
            const respCpf = document.getElementById('responsavel_cpf').value.trim();
            const campusSelecionado = document.getElementById('campus_selecionado').value.trim();
            const local = document.getElementById('local_cidade').value.trim();
            const data = document.getElementById('data_atual').value.trim();

            const errorMessage = document.getElementById('error-message');

            // Validação de todos os campos, incluindo o select
            if (!respNome || !menorNome || !menorCpf || !respCpf || !local || !data || !campusSelecionado) {
                errorMessage.classList.remove('hidden');
                return;
            }
            errorMessage.classList.add('hidden');

            // 2. Preenchimento Dinâmico (Span elements)
            
            // Variável para a data formatada
            const dataFormatada = formatDate(data);

            // Campos da introdução
            document.getElementById('display_responsavel_nome').textContent = respNome;
            document.getElementById('display_menor_nome_intro').textContent = menorNome;
            document.getElementById('display_menor_cpf_intro').textContent = menorCpf;
            
            // Campus de Referência
            document.getElementById('display_campus_selecionado').textContent = campusSelecionado;

            // Local e Data
            document.getElementById('display_local_cidade').textContent = `${local},`;
            document.getElementById('display_data_atual').textContent = `em ${dataFormatada}.`;

            // Campos da referência (rodapé)
            document.getElementById('display_menor_nome_ref').textContent = menorNome;
            document.getElementById('display_menor_cpf_ref').textContent = menorCpf;
            document.getElementById('display_responsavel_nome_ref').textContent = respNome;
            document.getElementById('display_responsavel_cpf_ref').textContent = respCpf;


            // 3. Configuração do html2pdf

            // Elemento HTML que contém o conteúdo a ser convertido
            const element = document.getElementById('pdf-content');

            // Configurações da conversão
            const options = {
                margin: 10,
                filename: `Termo_Consentimento_${menorNome.replace(/\s/g, '_')}_${dataFormatada.replace(/\//g, '-')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, logging: true, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // 4. Inicia a conversão
            html2pdf().set(options).from(element).save();

            // 5. Esconde o formulário e mostra o botão de re-gerar
            document.getElementById('form-fields').classList.add('hidden');
            document.getElementById('signing-instructions').classList.add('hidden'); // Esconde as instruções também
            document.getElementById('re-generate').classList.remove('hidden');
        }

        // Adiciona a data atual ao input tipo date
        window.onload = function() {
            // Preenche a data atual por padrão para facilitar o uso
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('data_atual').value = today;
        };
    </script>
</body>
</html>
